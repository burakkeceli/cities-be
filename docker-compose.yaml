##
# volume paths will be common later
# read Docker LB and 2 Tomcats to understand what this is doing
#
# difference between expose and port:
# http://stackoverflow.com/questions/35548843/
# does-ports-on-docker-compose-yml-have-the-same-effect-as-expose-on-dockerfile
##
db:
  image: 'postgres'
  container_name: 'postgres'
  ports:
    - '5432:5432'
  expose:
    - 5432
  environment:
    POSTGRES_USER: cities_master
    POSTGRES_DB: cities

cassandra:
  image: 'cassandra:latest'
  container_name: 'cassandra'
  ports:
    - '9042:9042'
    - '7199:7199'

nginx:
  image: 'nginx'
  ports:
    - '83:80'
  links:
    - tomcatOne:tomcat1
    - tomcatTwo:tomcat2
  volumes:
    - ${PWD}/docker/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf

tomcatOne:
  image: 'tomcat:8.0-jre8'
  container_name: 'tomcatOne'
  ports:
    - '8081:8080'
  volumes:
    - ${PWD}/docker/tomcat/server.xml:/usr/local/tomcat/conf/server.xml
    - ${PWD}/docker/tomcat/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml
    - ${PWD}/docker/tomcat/ROOT/index.jsp:/usr/local/tomcat/webapps/ROOT/index.jsp
  links:
    - db
    - cassandra

tomcatTwo:
  image: 'tomcat:8.0-jre8'
  container_name: 'tomcatTwo'
  ports:
    - '8082:8080'
  volumes:
    - ${PWD}/docker/tomcat/server.xml:/usr/local/tomcat/conf/server.xml
    - ${PWD}/docker/tomcat/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml
    - ${PWD}/docker/tomcat/ROOT/index.jsp:/usr/local/tomcat/webapps/ROOT/index.jsp
  links:
    - db
    - cassandra